#
# Print out compiled tree.
#
optgen compile test.opt
# Not comment.
define Not {
    Input Node
}

[EliminateNot, Normalize]
(Not (Not $input:*)) => $input
----
(Compiled
	(Defines
		(Define
			Comments=(Comments # Not comment.)
			Tags=(Tags)
			Name="Not"
			Fields=(DefineFields
<<<<<<< HEAD
				(DefineField Name="Input" Type="Expr" Src=<test.opt:3:5>)
=======
				(DefineField Name="Input" Type="Node" Src=<test.opt:3:5>)
>>>>>>> 1818c5d544... more
			)
			Src=<test.opt:2:1>
		)
	)
	(Rules
		(Rule
			Comments=(Comments)
			Name="EliminateNot"
			Tags=(Tags Normalize)
			Match=(Func
				Name=Not
				Args=(Slice
					(Func
						Name=Not
						Args=(Slice
<<<<<<< HEAD
							(Bind Label="input" Target=(Any Typ=Expr) Typ=Expr Src=<test.opt:7:11>)
=======
							(Bind Label="input" Target=(Any Typ=Node) Typ=Node Src=<test.opt:7:11>)
>>>>>>> 1818c5d544... more
						)
						Typ=Not
						Src=<test.opt:7:6>
					)
				)
				Typ=Not
				Src=<test.opt:7:1>
			)
<<<<<<< HEAD
			Replace=(Ref Label="input" Typ=Expr Src=<test.opt:7:25>)
=======
			Replace=(Ref Label="input" Typ=Node Src=<test.opt:7:25>)
>>>>>>> 1818c5
d544... more
			Src=<test.opt:6:1>
		)
	)
)

#
# Test multiple input files from glob pattern.
#
optgen compile all
define Gt {
    left  Node
    right Node
}
----
(Compiled
	(Defines
		(Define
			Comments=(Comments)
			Tags=(Tags)
			Name="Gt"
			Fields=(DefineFields
<<<<<<< HEAD
				(DefineField Name="left" Type="Expr" Src=<test.opt:2:5>)
				(DefineField Name="right" Type="Expr" Src=<test.opt:3:5>)
=======
				(DefineField Name="left" Type="Node" Src=<test.opt:2:5>)
				(DefineField Name="right" Type="Node" Src=<test.opt:3:5>)
>>>>>>> 1818c5d544... more
			)
			Src=<test.opt:1:1>
		)
	)
	(Rules
	)
)

#
# Test single compile error.
#
optgen compile test.opt
define Lt {}
define Lt {}
----
test.opt:2:1: duplicate 'Lt' define statement

#
# Test multiple parse errors.
#
optgen compile test.opt
define {}

[Name, Normalize]
(Foo) => ()

[Name, Normalize]
(Foo) =>
----
test.opt:1:8: expected define name, found '{'
... too many errors (2 more)
